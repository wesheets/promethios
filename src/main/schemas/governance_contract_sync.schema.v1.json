{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Governance Contract Sync Schema",
  "description": "Schema for governance contract synchronization across the mesh",
  "type": "object",
  "required": ["sync_id", "source_node_id", "target_node_ids", "contract_version", "contract_hash", "timestamp", "phase_id"],
  "properties": {
    "sync_id": {
      "type": "string",
      "description": "Unique identifier for this sync operation",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
    },
    "source_node_id": {
      "type": "string",
      "description": "ID of the source node",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
    },
    "target_node_ids": {
      "type": "array",
      "description": "IDs of the target nodes",
      "items": {
        "type": "string",
        "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
      },
      "minItems": 1
    },
    "contract_version": {
      "type": "string",
      "description": "Version of the contract being synchronized",
      "pattern": "^v\\d{4}\\.\\d{2}\\.\\d{2}$"
    },
    "contract_hash": {
      "type": "string",
      "description": "Hash of the contract for verification",
      "pattern": "^[a-f0-9]{64}$"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of the sync operation",
      "format": "date-time"
    },
    "phase_id": {
      "type": "string",
      "description": "Phase ID of the implementation",
      "pattern": "^\\d+(\\.\\d+)*$",
      "const": "5.5"
    },
    "sync_type": {
      "type": "string",
      "description": "Type of sync operation",
      "enum": ["full", "incremental", "diff"]
    },
    "diff": {
      "type": "object",
      "description": "Diff information for incremental syncs",
      "properties": {
        "base_version": {
          "type": "string",
          "description": "Base version for the diff",
          "pattern": "^v\\d{4}\\.\\d{2}\\.\\d{2}$"
        },
        "base_hash": {
          "type": "string",
          "description": "Hash of the base version",
          "pattern": "^[a-f0-9]{64}$"
        },
        "changes": {
          "type": "array",
          "description": "List of changes in the diff",
          "items": {
            "type": "object",
            "required": ["path", "operation", "value"],
            "properties": {
              "path": {
                "type": "string",
                "description": "JSON path to the changed element"
              },
              "operation": {
                "type": "string",
                "description": "Operation type",
                "enum": ["add", "remove", "replace"]
              },
              "value": {
                "description": "New value for add or replace operations"
              }
            }
          }
        }
      },
      "required": ["base_version", "base_hash", "changes"]
    },
    "successful_nodes": {
      "type": "array",
      "description": "IDs of nodes that successfully synchronized",
      "items": {
        "type": "string",
        "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
      }
    },
    "failed_nodes": {
      "type": "array",
      "description": "IDs of nodes that failed to synchronize",
      "items": {
        "type": "object",
        "required": ["node_id", "error"],
        "properties": {
          "node_id": {
            "type": "string",
            "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
          },
          "error": {
            "type": "string"
          }
        }
      }
    },
    "attestation": {
      "type": "object",
      "description": "Attestation for the sync operation",
      "required": ["attester_node_id", "signature"],
      "properties": {
        "attester_node_id": {
          "type": "string",
          "description": "ID of the attesting node",
          "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
        },
        "signature": {
          "type": "string",
          "description": "Cryptographic signature of the sync operation",
          "pattern": "^[A-Za-z0-9+/=]{43,86}$"
        },
        "timestamp": {
          "type": "string",
          "description": "ISO 8601 timestamp of the attestation",
          "format": "date-time"
        }
      }
    },
    "last_attested_by": {
      "type": "array",
      "description": "List of nodes that have attested to this contract version",
      "items": {
        "type": "object",
        "required": ["node_id", "timestamp"],
        "properties": {
          "node_id": {
            "type": "string",
            "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      }
    },
    "consensus_hash": {
      "type": "string",
      "description": "Hash of the consensus record for this sync operation",
      "pattern": "^[a-f0-9]{64}$"
    },
    "codex_clauses": {
      "type": "array",
      "description": "Codex clauses governing this sync operation",
      "items": {
        "type": "string",
        "pattern": "^\\d+(\\.\\d+)*$"
      },
      "const": ["5.5", "5.4", "11.0", "11.1", "5.2.5"]
    }
  }
}
